<!DOCTYPE html>
<html>
<head>
    <title>Multi-User Real-Time GPS Tracker</title>
    <meta charset="utf-8">

    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    />

    <style>
        body { font-family: Arial; }
        #map { height: 520px; }
        button {
            padding: 10px 18px;
            font-size: 16px;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <h2>üìç Multi-User Real-Time GPS Tracker</h2>
    <button onclick="startTracking()">Share My Location</button>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Unique ID for each user
        const userId = Math.random().toString(36).substring(2, 10);

        const map = L.map('map').setView([20.5937, 78.9629], 5);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap'
        }).addTo(map);

        let markers = {};

        function startTracking() {
            if (!navigator.geolocation) {
                alert("Geolocation not supported");
                return;
            }
            navigator.geolocation.watchPosition(sendLocation);
            setInterval(fetchLocations, 2000);
        }

        function sendLocation(position) {
            fetch("/update_location", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                    user_id: userId,
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude
                })
            });
        }

        function fetchLocations() {
            fetch("/get_locations")
                .then(res => res.json())
                .then(data => {
                    for (let id in data) {
                        const lat = data[id].lat;
                        const lng = data[id].lng;

                        if (markers[id]) {
                            markers[id].setLatLng([lat, lng]);
                        } else {
                            markers[id] = L.marker([lat, lng])
                                .addTo(map)
                                .bindPopup("User: " + id);
                        }
                    }
                });
        }
    </script>
</body>
</html>
